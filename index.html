<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Google Sheet Viewer</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    th.sorted-asc::after { content: " ▲"; }
    th.sorted-desc::after { content: " ▼"; }
    th { cursor: pointer; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="mb-3">Spreadsheet Data</h2>
    
    <!-- Global Search -->
    <input type="text" id="searchBox" class="form-control mb-3" placeholder="Search all columns...">
    
    <!-- Column Filters -->
    <div id="filters" class="mb-3 d-flex flex-wrap gap-2"></div>

    <!-- Data Table -->
    <div class="table-responsive">
      <table id="dataTable" class="table table-striped table-hover table-bordered"></table>
    </div>
  </div>

  <!-- Bootstrap JS (optional for interactivity) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRXOVsmu2z54kKeh7PgD7MdBLuYUywHJnWk3bufz9ASblb7_cwcTvoHpfDm90JA3A/pub?output=csv";

    let headers = [];
    let data = [];
    let sortState = { col: null, dir: null };

    async function loadSheet() {
      const res = await fetch(sheetURL + "&cacheBust=" + Date.now());
      const text = await res.text();

      const rows = text.trim().split("\n").map(r => r.split(","));
      headers = rows[0];
      data = rows.slice(1);

      renderTable(headers, data);
      createFilters(headers, data);

      document.getElementById("searchBox").addEventListener("keyup", applyFilters);
    }

    function createFilters(headers, data) {
      const filtersDiv = document.getElementById("filters");
      filtersDiv.innerHTML = "";
      headers.forEach((header, colIndex) => {
        const uniqueValues = [...new Set(data.map(row => row[colIndex]))].sort();
        const select = document.createElement("select");
        select.className = "form-select";
        select.style.minWidth = "150px";
        select.innerHTML = `<option value="">Filter by ${header}</option>` +
          uniqueValues.map(val => `<option value="${val}">${val}</option>`).join("");
        select.dataset.colIndex = colIndex;
        select.addEventListener("change", applyFilters);
        filtersDiv.appendChild(select);
      });
    }

    function applyFilters() {
      const searchText = document.getElementById("searchBox").value.toLowerCase();
      const selects = document.querySelectorAll("#filters select");
      const filterValues = Array.from(selects).map(sel => ({ col: sel.dataset.colIndex, val: sel.value }));

      let filtered = data.filter(row => {
        const matchSearch = row.join(" ").toLowerCase().includes(searchText);
        const matchFilters = filterValues.every(f => !f.val || row[f.col] === f.val);
        return matchSearch && matchFilters;
      });

      if (sortState.col !== null) {
        filtered.sort((a, b) => {
          let valA = a[sortState.col];
          let valB = b[sortState.col];

          let numA = parseFloat(valA);
          let numB = parseFloat(valB);
          if (!isNaN(numA) && !isNaN(numB)) {
            valA = numA;
            valB = numB;
          }

          if (valA < valB) return sortState.dir === "asc" ? -1 : 1;
          if (valA > valB) return sortState.dir === "asc" ? 1 : -1;
          return 0;
        });
      }

      renderTable(headers, filtered);
    }

    function renderTable(headers, rows) {
      const table = document.getElementById("dataTable");

      const headerHTML = headers.map((h, i) => {
        let cls = "";
        if (sortState.col === i) cls = sortState.dir === "asc" ? "sorted-asc" : "sorted-desc";
        return `<th data-col="${i}" class="${cls}">${h}</th>`;
      }).join("");

      const bodyHTML = rows.map(row => 
        `<tr>${row.map(cell => `<td>${cell}</td>`).join("")}</tr>`
      ).join("");

      table.innerHTML = `<thead class="table-dark"><tr>${headerHTML}</tr></thead><tbody>${bodyHTML}</tbody>`;

      table.querySelectorAll("th").forEach(th => {
        th.addEventListener("click", () => {
          const col = parseInt(th.dataset.col);
          if (sortState.col === col) {
            sortState.dir = sortState.dir === "asc" ? "desc" : "asc";
          } else {
            sortState.col = col;
            sortState.dir = "asc";
          }
          applyFilters();
        });
      });
    }

    loadSheet();
  </script>
</body>
</html>
